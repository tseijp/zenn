---
title: "Hono and React full stack dev"
emoji: "ğŸ”¥"
type: "tech"
topics:
  - "react"
  - "cloudflare"
  - "tailwind"
  - "sqlite"
  - "hono"
published: true
published_at: "2024-04-30 23:59"
---

https://tsei.jp/articles/2024/04/01/note/
â†‘english ver

Hono ã¯ ultra-fast ã§è»½é‡ãª Web æ¨™æº–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚
Hono å˜ä½“ã§ã® SPA é–‹ç™ºã¯å¤§å¤‰ã§ã™ãŒã€React ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ Next ã‚„ Remix ã®ã‚ˆã†ãªãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯æ©Ÿèƒ½ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚
Hono ã¯ãƒ„ãƒªãƒ¼æ§‹é€ ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãªã©ã€React ã ã‘ã§ã¯ä¸å¯èƒ½ãªè¡¨ç¾ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
ã¾ãŸã€å°ã•ãªãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã‚„ Node.js ã«ä¾å­˜ã—ãªã„ãŸã‚ã€Cloudflare ã®ã‚ˆã†ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ä½ã‚³ã‚¹ãƒˆã‹ã¤ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ã§ã™ã€‚
ã„ãã¤ã‹ã®ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã§ Hono ã‚’ã¤ã‹ã£ãŸã¨ãã¯ Server-Sent Events ã‚„ JWT èªè¨¼ãªã©ã‚’ AWS Lambda ã«çŸ­æœŸé–“ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã—ãŸã€‚

> ### examples
>
> - [honojs/honox: HonoX][honox]
>      - [[suggestion] Add Cloudflare DevServer config to Docs Â· Issue #39 Â· honojs/honox][honox-39]
>      - [[@hono/vite-dev-server] feature request: Support wrangler.toml Â· Issue #24 Â· honojs/vite-plugins][vite-plugin-24]
> - [yusukebe/honox-playground][honox-playground]
>      - [honox-playground/projects/react at main Â· yusukebe/honox-playground][honox-playground-react]
>      - [honox-playground/projects/cloudflare-bindings at main Â· yusukebe/honox-playground][honox-playground-cloudflare-bindings]
> - [yusukebe/honox-examples: HonoX examples][honox-examples]
>      - [honox-examples/projects/tailwind at main Â· yusukebe/honox-examples][honox-examples-tailwind]
>      - [honox-examples/projects/blog at main Â· yusukebe/honox-examples][honox-examples-blog]
> - [yusukebe (yusukebe) / Repositories][yusukebe]
>      - [yusukebe/hono-spa-react][hono-spa-react]
>      - [yusukebe/hono-htmx: Hono+htmx stack][hono-htmx]
>
> ### articles
>
> - hono / honox ã«ã¤ã„ã¦
>      - [Hono + htmx + Cloudflare ã¯æ–°ã—ã„ã‚¹ã‚¿ãƒƒã‚¯ã§ã™ - å’Œç”° ç¥ä»‹][r1]
>      - [Hono ã§ API ä»˜ãé›‘ React SPA æœ€å°][r2]
>      - [HonoX ã§ tailwindcss ã‚’ä½¿ã†][r3]
> - d1 ã«ã¤ã„ã¦
>      - [Cloudflare D1 Database and Workers REST API CRUD Operation with Hono][r4]
>      - [Build a Comments API Â· Cloudflare D1 docs][r5]
>      - [Query D1 from Hono Â· Cloudflare D1 docs][r6]
> - hono + d1 ã«ã¤ã„ã¦
>      - [Cloudflare Workers + Hono + Cloudflare D1 ã‚’ä½¿ã£ã¦ã€CDN ã‚¨ãƒƒã‚¸ã®ã¿ã§å‹•ã WebAPI ã‚’ä½œã£ã¦ã¿ãŸ | DevelopersIO][r7]
>      - [Hono ã¨ Cloudflare D1 ã¨ Drizzle ORM ã‚’ä½¿ã£ã¦ Web API ã‚’ä½œã‚‹ #cloudflare - Qiita][r8]
>      - [Cloudflare Pages + Next.js + Hono + D1 + Drizzle ã§å§‹ã‚ã‚‹ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯æ§‹æˆ][r9]
>
> [honox]: https://github.com/honojs/honox
> [honox-39]: https://github.com/honojs/honox/issues/39#issuecomment-1955716487
> [vite-plugin-24]: https://github.com/honojs/vite-plugins/issues/24#issuecomment-1962413558
> [honox-playground]: https://github.com/yusukebe/honox-playground
> [honox-playground-react]: https://github.com/yusukebe/honox-playground/tree/main/projects/react
> [honox-playground-cloudflare-bindings]: https://github.com/yusukebe/honox-playground/tree/main/projects/cloudflare-bindings
> [honox-examples]: https://github.com/yusukebe/honox-examples
> [honox-examples-tailwind]: https://github.com/yusukebe/honox-examples/tree/main/projects/tailwind
> [honox-examples-blog]: https://github.com/yusukebe/honox-examples/tree/main/projects/blog
> [yusukebe]: https://github.com/yusukebe?tab=repositories
> [hono-spa-react]: https://github.com/yusukebe/hono-spa-react
> [hono-htmx]: https://github.com/yusukebe/hono-htmx

[r1]: https://blog.yusu.ke/hono-htmx-cloudflare/
[r2]: https://zenn.dev/yusukebe/articles/06d9cc1714bfb7
[r3]: https://zenn.dev/ryuapp/scraps/503cb72f57c7bb
[r4]: https://everythingcs.dev/blog/cloudflare-d1-workers-rest-api-crud-operation/
[r5]: https://developers.cloudflare.com/d1/tutorials/build-a-comments-api/
[r6]: https://developers.cloudflare.com/d1/examples/d1-and-hono/
[r7]: https://dev.classmethod.jp/articles/getting-started-cloudflare-workers-hono-cloudflare-d1/
[r8]: https://qiita.com/kmkkiii/items/2b22fa53a90bf98158c0
[r9]: https://zenn.dev/da1/articles/cloudflare-nextjs-hono-drizzle

### getting started

Hono ç’°å¢ƒã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ä»Šå›ã¯ file based rooting ã‚’ä½¿ã„ãŸã„ãŸã‚ x-basic ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã—ãŸãŒã€ä»–ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸ã¶ã“ã¨ã§ã€Cloudflare ãªã©ã§ã•ã‚‰ã«é€Ÿãå…¨ä¸–ç•Œã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```ruby
$ npm create hono@latest

create-hono version 0.7.0
âœ” Target directory â€¦ hono
âœ” Which template do you want to use? â€º x-basic
cloned honojs/starter#main to $/glre/examples/hono
? Do you want to install project dependencies? no
ğŸ‰ Copied project files
Get started with: cd hono
```

ã“ã“ã¾ã§ã® diff

https://github.com/tseijp/glre/pull/22/commits/db62518b8513890b5ea942ce706cca3780885ab5

### setup

react ã‚„ vite ã‚’ä½¿ã†ãŸã‚ã«ã€[honox-playground/projects/react][honox-playground-react] ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚`package.json` ã® dependencies ã« react ã‚„ tailwind ãªã©ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ruby
npm i @hono/react-renderer @types/react @types/react-dom autoprefixer postcss react@18 react-dom@18 tailwindcss
```

> ```ruby
> // package.json
>   "@cloudflare/workers-types": "4",
> + "@hono/react-renderer": "latest",
>   "@hono/vite-cloudflare-pages": "latest",
> + "@types/react": "18",
> + "@types/react-dom": "18",
> + "autoprefixer": "10",
> + "postcss": "8",
> + "react": "18",
> + "react-dom": "18",
> + "tailwindcss": "3",
> ```

`tsconfig.json` ã‹ã‚‰ `"jsxImportSource": "hono/jsx"`ã‚’å‰Šé™¤ã—ã€Hono ã® default ã®è¨­å®šã®ä¾å­˜ã‚’æ¸›ã‚‰ã—ã¾ã™ã€‚(ãŠå¥½ã¿ã§ã™ãŒã„ã¤ã‚‚é€šã‚Š Next.js åŒæ§˜ã®è¨­å®šã«ã—ã¾ã—ãŸã€‚)

:::message alert
5/5 release ã® `honox@0.1.16` ã‚ˆã‚Š `"jsxImportSource": "react",` ã®è¡Œã‚’è¿½åŠ ã—ãªã„ã¨ã€ islands ã®æŒ™å‹•ãŒä¸å®‰å®šã§ã™ã€ã€ã€
:::

> ```ruby
> // tsconfig.json
> {
>   "compilerOptions": {
>     "target": "es5",
>     "lib": ["dom", "dom.iterable", "esnext"],
>     "allowJs": true,
>     "skipLibCheck": true,
>     "strict": true,
>     "noEmit": true,
>     "esModuleInterop": true,
>     "module": "esnext",
>     "moduleResolution": "bundler",
>     "resolveJsonModule": true,
>     "isolatedModules": true,
>     "jsx": "react-jsx",
>     "jsxImportSource": "react",
>     "incremental": true,
>   },
>   "include": ["**/*.ts", "**/*.tsx"],
>   "exclude": ["node_modules"]
> }
> ```

React ã® SSR ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã‚ˆã†ã«ã€vite.config.ts ã« `ssr.external` ã‚’è¿½åŠ ã—ã¾ã™ã€‚ï¼ˆã‚µãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã§ããªã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã™ã¹ã¦æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰

```ts
// vite.config.ts
...
export default defineConfig(() => {
  return {
+   ssr: {
+     external: ['react', 'react-dom'],
+   },
    plugins: [honox(), pages()],
  }
});
```

### support react

`hono/jsx` ã‹ã‚‰ React ã¸ã®ç§»è¡Œã®ãŸã‚ã€`_renderer.tsx` ã« `@hono/react-renderer` ã‚’é©å¿œã—ã¾ã™ã€‚(react ã ã‘ã§ãªãã€preact ã‚„ solid ã®ã‚ˆã†ãªä»»æ„ã® UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‚ä½¿ã†ã“ã¨ã‚‚ã§ãã¾ã™ã€‚)

<!--prettier-ignore-->
```tsx
// app/routes/_renderer.tsx
import { reactRenderer } from '@hono/react-renderer'

export default reactRenderer(({ children, title }) => {
  const src = import.meta.env.PROD
    ? '/static/client.js'
    : '/app/client.ts'
  return (
    <html lang="en">
      <head>
        <meta charSet="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <script type="module" src={src}></script>
      </head>
      <body>{children}</body>
    </html>
  )
})
```

> ### React case
>
> You can define a renderer using [`@hono/react-renderer`](https://github.com/honojs/middleware/tree/main/packages/react-renderer). Install the modules first.
>
> ```txt
> npm i @hono/react-renderer react react-dom hono
> npm i -D @types/react @types/react-dom
> ```
>
> Define the Props that the renderer will receive in `global.d.ts`.
>
> <!--prettier-ignore-->
> ```ts
> // global.d.ts
> import '@hono/react-renderer'
> 
> declare module '@hono/react-renderer' {
>   interface Props {
>     title?: string
>   }
> }
> ```
>
> ...

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€šã‚Šã€`app/client.tsx` ã‚’å¤‰æ›´ã—ã¦ React hydration ã¨ rendering ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚ï¼ˆç¾çŠ¶ Type Error ãŒãŸãã•ã‚“å‡ºåŠ›ã•ã‚Œã‚‹ã®ã§ã€ä»Šå¾Œ honox ã® ã‚³ãƒ¼ãƒ‰ã‚’ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰

```tsx
// app/client.tsx
import { createClient } from 'honox/client'

- createClient()

+ createClient({
+   hydrate: async (elem, root) => {
+     const { hydrateRoot } = await import('react-dom/client')
+     hydrateRoot(root, elem)
+   },
+   createElement: async (type, props) => {
+     const { createElement } = await import('react')
+     return createElement(type, props)
+   },
+ })
```

ä»£ã‚ã‚Šã« tailwind ã‚’æ¡ç”¨ã—ã¾ã™ã®ã§ `routes/index.ts` ã‹ã‚‰ `hono/css` ã‚’å–ã‚Šé™¤ãã¾ã™ã€‚

```tsx
// app/routes/index.ts
- import { css } from 'hono/css'
import { createRoute } from 'honox/factory'
import Counter from '../islands/counter'

- const className = css`
-   font-family: sans-serif;
- `

export default createRoute((c) => {
  const name = c.req.query('name') ?? 'Hono'
  return c.render(
-   <div class={className}>
+   <div>
      <h1>Hello, {name}!</h1>
      <Counter />
    </div>,
```

`counter.tsx` ã§ `hono/jsx` ã‹ã‚‰ React ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚’è¡Œã„ã€æ—¢å­˜ã®ãƒ‡ãƒ¢ã‚’ React ã‚’ä½¿ç”¨ã—ã¦å®Ÿè¡Œå¯èƒ½ã«ã—ã¾ã™ã€‚ `yarn dev` ã§ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ã€ã“ã‚Œã‚‰ã®å¤‰æ›´ãŒç¢ºèªã§ãã¾ã™ã€‚

```ts
// app/islands/counter.tsx
- import { useState } from 'hono/jsx'
+ import { useState } from 'react'
```

ã“ã“ã¾ã§ã® diff

https://github.com/tseijp/glre/pull/22/commits/4b46254b0e22b3d7a736d36047fe54814a0dbacf

### support tailwind

Hono ã¨çµ„ã¿åˆã‚ã›ã¦ Tailwind CSS ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ã«ã€`tailwind.config.js`, `postcss.config.js`, `app/style.css` ã‚’ä½œæˆã—ã¾ã™ã€‚ï¼ˆNext.js åŒæ§˜ã„ã¤ã‚‚é€šã‚Šã§ã™ãŒã€document ã«ã‚‚æ–¹æ³•ãŒæ›¸ã„ã¦ã‚ã‚Šã¾ã™ï¼‰

> ### Using Tailwind CSS
>
> Given that HonoX is Vite-centric, if you wish to utilize [Tailwind CSS](https://tailwindcss.com/), simply adhere to the official instructions.
>
> Prepare `tailwind.config.js` and `postcss.config.js`:
>
> <!--prettier-ignore-->
> ```js
> // tailwind.config.js
> export default {
>   content: ['./app/**/*.tsx'],
>   theme: {
>     extend: {},
>   },
>   plugins: [],
> }
> ```
>
> <!--prettier-ignore-->
> ```js
> // postcss.config.js
> export default {
>   plugins: {
>     tailwindcss: {},
>     autoprefixer: {},
>   },
> }
> ```
>
> Write `app/style.css`:
>
> ```css
> /* app/style.css */
> @tailwind base;
> @tailwind components;
> @tailwind utilities;
> ```
>
> ...

`_renderer.tsx` ã‚’ä¿®æ­£ã—ã¦ tailwind css ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```ts
// app/routes/_renderer.tsx
import { reactRenderer } from '@hono/react-renderer'

export default reactRenderer(({ children, title }) => {
+ const href = import.meta.env.PROD
+   ? 'static/assets/style.css'
+   : '/app/style.css'
...
        <meta name='viewport' content='width=device-width, initial-scale=1.0' />
+       <link href={href} rel="stylesheet" />
        <script type="module" src={src}></script>
...
```

`routes/index.ts` ã«ã¤ã„ã¦`hono/css` ã‚’æ—¢ã«æ¶ˆã—ãŸã®ã§ã€ è©¦ã—ã«ä»£ã‚ã‚Šã® Tailwind ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ ã—ã¦ã¿ã¾ã™ã€‚

```tsx
// app/routes/index.ts
export default createRoute((c) => {
  const name = c.req.query('name') ?? 'Hono'
  return c.render(
-   <div>
+   <div className="font-sans">
```

`vite.config.js` ã‚’ä¿®æ­£ã—ã€ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰æ™‚ã« tailwind ãŒ build ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts
// vite.config.js
export default defineConfig(({ mode }) => {
  if (mode === 'client') {
    return {
+     build: {
+       rollupOptions: {
+         input: ['/app/style.css'],
+         output: {
+           assetFileNames: 'static/assets/[name].[ext]'
+         }
+       }
+     },
      plugins: [client()],
    }
...
```

ã“ã“ã¾ã§ã® diff

https://github.com/tseijp/glre/pull/22/commits/fc24c6cfe42aa4357a40eac4312b825c29047d07

### add d1 sqlite

[Build a Comments API Â· Cloudflare D1 docs][r5] ã®å…¬å¼ docs ã¨ [honox-playground/projects/cloudflare-bindings][honox-playground-cloudflare-bindings] ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«å®Ÿè£…ã§ããã†ã§ã™ã€‚
wrangler ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãªã©ã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã§ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸå¾Œã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
ãƒ†ã‚­ã‚¹ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã®ã§ã€`wrangler.toml` ã¨ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚

```
npx wrangler d1 create xxx
```

> ```toml
> # wrangler.toml
> [[ d1_databases ]]
> binding = "DB" # i.e. available in your Worker on env.DB
> database_name = "xxx"
> database_id = "yyyyyyyyyyyyyyyyyyyyyyyy"
> ```

`dump.sql` ã§ Cloudflare D1 ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã‚’å®šç¾©ã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«ã¨åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®šã‚’ã—ã¾ã™ã€‚
ï¼ˆæœ¬ç•ªç’°å¢ƒã® Cloudflare Pages / Worker ã‹ã‚‰ D1 ã‚’ã¤ã‹ã†ã«ã¯ã€ Cloudflare ã® Console ã‹ã‚‰ã€ `Settings/Function/D1 database bindings` ã‚’é¸æŠã—ã€`Variable name` property ã« `DB` , `D1 database` property ã«ä½œæˆã—ãŸ `database_name = xxx` ã‚’æŒ‡å®šã—ã¦ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼‰

- `npx wrangler d1 execute xxx --local --file=./app/schemas/dump.sql`
  (xxx ã¯æŒ‡å®šã—ãŸåå‰ã§ã€`--local` ã‚’å¤–ã™ã¨ Cloudflare ã« deploy ã•ã‚Œã¾ã™ã€‚)
- `npx wrangler d1 execute xxx --local --command='SELECT * FROM creation'`
  (ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã¾ã™ã€‚)

```sql
/* app/schemas/dump.sql */
DROP TABLE IF EXISTS `creation`;
CREATE TABLE `creation` (
  `id` TEXT PRIMARY KEY,
  `title` TEXT DEFAULT NULL,
  `content` TEXT DEFAULT NULL,
  `created_at` TEXT DEFAULT (datetime('now')),
  `updated_at` TEXT DEFAULT (datetime('now'))
);
INSERT INTO `creation` (id, title, content) VALUES ('a_id', 'a_title', 'a_content');
INSERT INTO `creation` (id, title, content) VALUES ('b_id', 'b_title', 'b_content');
INSERT INTO `creation` (id, title, content) VALUES ('c_id', 'c_title', 'c_content');
```

> ```ruby
> â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚ id   â”‚ title   â”‚ content   â”‚ created_at          â”‚ updated_at          â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚ a_id â”‚ a_title â”‚ a_content â”‚ 2024-04-30 11:59:59 â”‚ 2024-04-30 11:59:59 â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚ b_id â”‚ b_title â”‚ b_content â”‚ 2024-04-30 11:59:59 â”‚ 2024-04-30 11:59:59 â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚ c_id â”‚ c_title â”‚ c_content â”‚ 2024-04-30 11:59:59 â”‚ 2024-04-30 11:59:59 â”‚
> â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
> ```

`vite.config.ts`ã‚’ä¿®æ­£ã—ã¦é–‹ç™ºãƒ“ãƒ«ãƒ‰ç”¨ã« wrangler ã‚’è¨­å®šã—ã¾ã™ã€‚
(`server.watch.ignored`ã« `.mf` ã‚’è¿½åŠ ã—ãªã„ã¨ vite ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ãƒã‚°ãŒã‚ã£ãŸã®ã§ã™ãŒã€
ä¿®æ­£ PR ã‚’ã ã—ãŸã‚‰ã™ãã« [merge][merge] ã•ã‚Œã¾ã—ãŸ ğŸ‰)

[merge]: https://github.com/honojs/vite-plugins/pull/111

```ts
// vite.config.ts
...
+ import { getPlatformProxy } from 'wrangler'

- export default defineConfig(({ mode }) => {
+ export default defineConfig(async ({ mode }) => {
  if (mode === 'client') {
    ...
  } else {
+   const { env, dispose } = await getPlatformProxy();
    return {
      ssr: {
        external: ['react', 'react-dom'],
      },
-     plugins: [honox(), pages()],
+     plugins: [
+       honox({
+         devServer: {
+           env,
+           plugins: [{ onServerClose: dispose }],
+         },
+       }),
+       pages(),
+     ],
  }
```

ã“ã“ã¾ã§ã® diff

https://github.com/tseijp/glre/pull/22/commits/c6d34f0a1d2fa679f0fbe4700263e9ac90c0a7ed

### make service

[Query D1 from Hono Â· Cloudflare D1 docs][r6] ã®å…¬å¼ docs ã¨ [honox-examples/projects/blog at main Â· yusukebe/honox-examples][honox-examples-blog] ã®ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«å®Ÿè£…ã§ããã†ã§ã™ï¼
ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆãƒ»æ›´æ–°ãƒ»å‰Šé™¤ã™ã‚‹ãŸã‚ã® API ã¨ã—ã¦ã€`routes/index.tsx`, `routes/new.tsx`, `routes/[userId]/[id]/index.tsx` ã® 3 ã¤ã® route ã‚’ä½œæˆã—ã¾ã—ãŸã€‚

> <!--prettier-ignore-->
> ```tsx
> // app/routes/index.tsx
> import { cors } from 'hono/cors'
> import { createRoute } from 'honox/factory'
> import App from '../islands/home'
>
> export const GET = createRoute(cors(), async (c) => {
>   const { results } = await c.env.DB.prepare(`select * from creation`).all()
>   const creationItems = results
>   return c.render(<App creationItems={creationItems} />)
> })
> ```
>
> <!--prettier-ignore-->
> ```tsx
> // app/routes/new.tsx
> import { z } from 'zod'
> import { cors } from 'hono/cors'
> import { createRoute } from 'honox/factory'
> import { zValidator } from '@hono/zod-validator'
> import App from '../islands/new'
>
> export const GET = createRoute(cors(), async (c) => {
>   return c.render(<App />)
> })
>
> const schema = z.object({
>   title: z.string().min(1),
>   content: z.string().min(1),
> })
>
> export const POST = createRoute(
>   cors(),
>   zValidator('json', schema, (result, c) => {
>     if (!result.success) return c.render('Error')
>   }),
>   async (c) => {
>     const { title, content } = c.req.valid('json')
>     const id = crypto.randomUUID()
>     const { success } = await c.env.DB.prepare(
>       `INSERT INTO creation (id, title, content) VALUES (?, ?, ?)`
>     )
>       .bind(id, title, content)
>       .run()
>     if (success) {
>       c.status(201)
>       return c.json({ id })
>     } else {
>       c.status(500)
>       return c.json({ message: 'Something went wrong' })
>     }
>   }
> )
>
> export type CreateAppType = typeof POST
> ```
>
> <!--prettier-ignore-->
> ```tsx
> // app/routes/[userId]/[id]/index.tsx
> import { z } from 'zod'
> import { createRoute } from 'honox/factory'
> import { basicAuth } from 'hono/basic-auth'
> import { zValidator } from '@hono/zod-validator'
> import { cors } from 'hono/cors'
> import App from '../../../islands/edit'
>
> const AUTH = basicAuth({
>   username: 'username',
>   password: 'password',
> })
>
> export const GET = createRoute(cors(), AUTH, async (c) => {
>   const { id } = c.req.param()
>   const { results } = await c.env.DB.prepare(
>     `select * from creation where id = ?`
>   )
>     .bind(id)
>     .all()
>   const item = results[0]
>
>   return c.render(
>     <App
>       creationId={id}
>       creationTitle={item.title}
>       creationContent={item.content}
>     />
>   )
> })
>
> const schema = z.object({
>   title: z.string().min(1),
>   content: z.string().min(1),
> })
>
> export const PUT = createRoute(
>   cors(),
>   zValidator('json', schema, (result, c) => {
>     if (!result.success) {
>       return c.render('Error', {
>         hasScript: true,
>       })
>     }
>   }),
>   async (c) => {
>     const { id } = c.req.param()
>     const { title, content } = c.req.valid('json')
>     const { success } = await c.env.DB.prepare(
>       `UPDATE creation SET title = ?, content = ? WHERE id = ?`
>     )
>       .bind(title, content, id)
>       .run()
>     if (success) {
>       c.status(201)
>       return c.json({ id })
>     } else {
>       c.status(500)
>       return c.json({ message: 'Something went wrong' })
>     }
>   }
> )
>
> export const DELETE = createRoute(cors(), async (c) => {
>   const { id } = c.req.param()
>   const { success } = await c.env.DB.prepare(
>     `DELETE FROM creation WHERE id = ?`
>   )
>     .bind(id)
>     .run()
>   if (success) {
>     c.status(201)
>     return c.json({ message: 'Deleted' })
>   } else {
>     c.status(500)
>     return c.json({ message: 'Something went wrong' })
>   }
> })
> ```

vercel ã® v0.dev ã¨ã„ã† AI ã§ UI ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ä½œã‚Šã¾ã—ãŸã€‚
v0.dev ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ chatgpt ã«æ•™ãˆã¦ã‚‚ã‚‰ã„ã€å‡ºåŠ›ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã„ã„æ„Ÿã˜ã«ã™ã‚‹ã¨ã„ã„æ„Ÿã˜ã«ãªã‚Šã¾ã™ï¼
ã‚ã¨ã¯ `npm run deploy` ã‚’å®Ÿè¡Œã—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å®Œäº†ã§ã™ï¼
Cloudflare ã®ãƒ‡ãƒ—ãƒ­ã‚¤é€Ÿåº¦ãŒ AWS ã®ã‚ˆã†ãªä»–ã‚µãƒ¼ãƒ“ã‚¹ãŒæ•°åˆ†ã‹ã‹ã‚‹ã®ã«å¯¾ã—ã¦çˆ†é€Ÿãªã®ã‚‚ã™ã”ãå¥½ãã§ã™ï¼

[
![](https://storage.googleapis.com/zenn-user-upload/ff7d1bbb6040-20240501.gif)
![](https://storage.googleapis.com/zenn-user-upload/6fcd8e63f6b0-20240501.gif)
](https://play.glre.dev)

https://play.glre.dev

â†‘ [play.glre.dev](https://play.glre.dev) ã§ã‚ãã¹ã¾ã™ ğŸ’ª
